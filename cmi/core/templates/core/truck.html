{% extends 'core/base.html' %}

{% block content %}
<main class="col-md-10 ms-sm-auto px-md-4">

  <!-- Page Title -->
  <div class="d-flex justify-content-between flex-wrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h2>Truck Overview</h2>
  </div>

  <!-- KPI Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card card-stat shadow-sm p-3 mb-3">
        <h6>Particulars</h6>
        <h3>25</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card card-stat shadow-sm p-3 mb-3">
        <h6>Active Trucks</h6>
        <h3>20</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card card-stat shadow-sm p-3 mb-3">
        <h6>Inactive Trucks</h6>
        <h3>5</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card card-stat shadow-sm p-3 mb-3">
        <h6>Average Productivity</h6>
        <h3>80%</h3>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="row mb-4">
    <div class="col-md-12">
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#truckFormModal">
        Add New Truck Record
      </button>
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#truckImportModal">
        Import from Excel
      </button>
    </div>
  </div>

  <!-- Truck Details Table -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card shadow-sm p-3 mb-3">
        <h5 class="card-title">Truck Details</h5>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Truck ID</th>
              <th>Type</th>
              <th>Status</th>
              <th>Productivity</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>T001</td>
              <td>Dump Truck</td>
              <td>Active</td>
              <td>85%</td>
            </tr>
            <tr>
              <td>T002</td>
              <td>Tipper Truck</td>
              <td>Inactive</td>
              <td>N/A</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Productivity Chart -->
  <div class="row">
    <div class="col-md-12 mb-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Truck Productivity Trend</h5>
          <canvas id="truckProductivityChart"></canvas>
        </div>
      </div>
    </div>
  </div>

</main>

<!-- ðŸšš Modal: Add Truck -->
<div class="modal fade" id="truckFormModal" tabindex="-1" aria-labelledby="truckModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="truckModalLabel">Add New Truck Record</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="post" id="truckForm">
          {% csrf_token %}
          <div class="mb-3">
            <label for="truckId" class="form-label">Truck ID</label>
            <input type="text" class="form-control" id="truckId" name="truck_id">
          </div>
          <div class="mb-3">
            <label for="productivity" class="form-label">Productivity (%)</label>
            <input type="number" class="form-control" id="productivity" name="productivity">
          </div>
          <button type="submit" class="btn btn-success">Save Record</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ðŸ“¥ Modal: Import from Excel -->
<div class="modal fade" id="truckImportModal" tabindex="-1" aria-labelledby="importModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="importModalLabel">Import Trucks from Excel</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="post" enctype="multipart/form-data" id="importForm">
          {% csrf_token %}
          <div class="mb-3">
            <label for="excelFile" class="form-label">Upload Excel File</label>
            <input type="file" class="form-control" id="excelFile" name="excel_file" accept=".xlsx, .xls">
          </div>
          <button type="submit" class="btn btn-success">Import</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<!-- âœ… Bootstrap JS Bundle (Required for modals) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- âœ… Chart.js for the chart -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const ctx = document.getElementById('truckProductivityChart').getContext('2d');
  const truckProductivityChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['January', 'February', 'March', 'April', 'May'],
      datasets: [{
        label: 'Productivity',
        data: [80, 85, 90, 95, 100],
        borderColor: 'rgba(13, 110, 253, 1)',
        backgroundColor: 'rgba(13, 110, 253, 0.2)',
        fill: true
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
{% endblock %}
